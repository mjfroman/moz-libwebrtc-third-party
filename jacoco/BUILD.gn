# Copyright 2019 The Chromium Authors
# Use of this source code is governed by a BSD-style license that can be
# found in the LICENSE file.

import("//build/config/android/rules.gni")

java_group("jacoco_all_java") {
  testonly = true
  deps = [
    ":jacocoagent_java",
    ":jacocoant_java",
    ":jacococli_java",
    ":org_jacocoagent_java",
    ":org_jacocoant_java",
    ":org_jacococore_java",
    ":org_jacocoreport_java",
  ]
}

# Needed to suppress stack traces being logged in every test like:
# java.io.FileNotFoundException: /jacoco.exec: open failed: EROFS (Read-only file system).
# https://crbug.com/1334374
# https://github.com/jacoco/jacoco/issues/968
java_prebuilt("jacocoagent_properties_java") {
  include_java_resources = true
  supports_android = true
  jar_path = "jacoco-agent.properties.jar"
}

java_prebuilt("jacocoagent_java") {
  include_java_resources = true
  supports_android = true
  jar_path = "lib/jacocoagent.jar"
  proguard_configs = [ "jacoco_instrument.flags" ]
  deps = [ ":jacocoagent_properties_java" ]
}

java_prebuilt("jacocoant_java") {
  testonly = true
  jar_path = "lib/jacocoant.jar"
}

java_prebuilt("jacococli_java") {
  testonly = true
  jar_path = "lib/jacococli.jar"
}

java_prebuilt("org_jacocoagent_java") {
  testonly = true
  jar_path = "lib/org.jacoco.agent-0.8.3.201901230119.jar"
}

java_prebuilt("org_jacocoant_java") {
  testonly = true
  jar_path = "lib/org.jacoco.ant-0.8.3.201901230119.jar"
}

java_prebuilt("org_jacococore_java") {
  testonly = true
  jar_path = "lib/org.jacoco.core-0.8.3.201901230119.jar"
}

java_prebuilt("org_jacocoreport_java") {
  testonly = true
  jar_path = "lib/org.jacoco.report-0.8.3.201901230119.jar"
}
