<!DOCTYPE html>
<html>
<head>
<script src="/resources/testharness.js"></script>
<script src="/resources/testharnessreport.js"></script>
<script src="/gen/layout_test_data/mojo/public/js/mojo_bindings.js"></script>
<script src="/gen/media/midi/midi_service.mojom.js"></script>
<script src="resources/mock-midiservice.js"></script>
</head>
<body>
<script>
promise_test(async _ => {
  const iframe = document.createElement('iframe');
  document.body.appendChild(iframe);
  const detachedNavigator = iframe.contentWindow.navigator;
  const detachedExceptionCtor = iframe.contentWindow.DOMException;
  document.body.removeChild(iframe);

  try {
    await detachedNavigator.requestMIDIAccess();
    return Promise.reject('requestMIDIAccess should have failed.');
  } catch (e) {
    assert_equals(e.constructor, detachedExceptionCtor);
    assert_equals(e.code, DOMException.ABORT_ERR);
  }
}, 'requestMIDIAccess fails in a detached frame');
</script>
</body>
</html>
