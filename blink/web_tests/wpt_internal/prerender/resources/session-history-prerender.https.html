<!DOCTYPE html>
<script src="session-history-harness.js"></script>
<body>
  <script>
    function testHistoryPushStateInPrerender() {
      assert(history.length == 1, "Initial history length");
      assert(!history.state, "Initial history state");

      history.pushState("teststate", null, null);

      assert(history.length == 1, "History length unchanged");
      assert(history.state == "teststate", "Update state");
    }

    function testHistoryReplaceStateInPrerender() {
      assert(history.length == 1, "Initial history length");
      assert(!history.state, "Initial history state");

      history.replaceState("teststate", null, null);

      assert(history.length == 1, "History length unchanged");
      assert(history.state == "teststate", "Update state");
    }

    function testLocationAssignInPrerender() {
      assert(history.length == 1, "Initial history length");
      const initialLocation = location.href;
      location.assign("#test");

      assert(history.length == 1, "History length unchanged");
      assert(location.href != initialLocation, "Update location");
    }

    function testLocationReplaceInPrerender() {
      assert(history.length == 1, "Initial history length");
      const initialLocation = location.href;
      location.replace("#test");

      assert(history.length == 1, "History length unchanged");
      assert(location.href != initialLocation, "Update location");
    }

    function testSetLocationHrefInPrerender() {
      assert(history.length == 1, "Initial history length");
      const initialLocation = location.href;
      location.href = "#test";

      assert(history.length == 1, "History length unchanged");
      assert(location.href != initialLocation, "Update location");
    }

    function testSyntheticAnchorClickInPrerender() {
      assert(history.length == 1, "Initial history length");
      const initialLocation = location.href;

      const anchor = document.createElement("a");
      anchor.href = "#test";
      document.body.appendChild(anchor);

      anchor.click();

      assert(history.length == 1, "History length unchanged");
      assert(location.href != initialLocation, "Update location");
    }

    function testHistoryGoInPrerender() {
      assert(history.length == 1, "Initial history length");
      const initialLocation = location.href;

      history.go(0);

      assert(history.length == 1, "History length unchanged");
      assert(location.href == initialLocation, "Location doesn't change");
    }

    function testLocationReloadInPrerender() {
      assert(history.length == 1, "Initial history length");
      const initialLocation = location.href;

      window.location.reload();

      assert(history.length == 1, "History length unchanged");
      assert(location.href == initialLocation, "Location doesn't change");
    }
  </script>
</body>
