<!DOCTYPE html>
<script src="/resources/testdriver.js"></script>
<script src="/resources/testdriver-actions.js"></script>
<script src="/resources/testdriver-vendor.js"></script>
<script src="utils.js"></script>
<title>Fenced frame content to test pointer lock</title>

<body>
<script>
(() => {
  const canvas = document.createElement('canvas');
  document.body.appendChild(canvas);
  const button = document.createElement('button');
  button.appendChild(document.createTextNode('Click'));
  button.addEventListener('click', async () => {
    const pointer_lock_key = KEYS['pointer-lock'];
    const pointerlockerror_promise = new Promise(resolve => {
      document.addEventListener('pointerlockerror', resolve);
    });
    try {
      await canvas.requestPointerLock();
      writeValueToServer(pointer_lock_key, 'Pointer lock succeeded');
    } catch (e) {
      await pointerlockerror_promise;
      writeValueToServer(pointer_lock_key, 'Pointer lock failed');
    }
    document.exitPointerLock();
  });
  document.body.appendChild(button);
  new test_driver
      .Actions()
      .pointerMove(/*x=*/ 0, /*y=*/ 0, {origin: button})
      .pointerDown()
      .pointerUp()
      .send();
})();
</script>
</body>
