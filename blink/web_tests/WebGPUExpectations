# tags: [ Android Fuchsia IOS IOS12.2 IOS13.0 Linux Mac Mac10.10 Mac10.11 Mac10.12 Retina
#         Mac10.13 Win Win7 Win10 ]
# tags: [ Release Debug ]
# results: [ Timeout Crash Pass Failure Slow Skip RetryOnFailure ]

# WebGPU tests are only run on GPU bots, so they are skipped by default and run
# separately from other Web Tests, with this expectations file.
#
# *********************************** NOTE ***********************************
# The contents of this file affect the way tests are broken down in
# web_tests/wpt_internal/webgpu/cts.html.
# You can add expectations which are at a finer granularity than the list of
# "variants" already in that file: just edit this file, then run
# third_party/blink/web_tests/webgpu/regenerate_internal_cts_html.sh.
#
# Expectations in this file must not (currently) use wildcards.
#
# Expectations in this file must apply to wpt_internal/webgpu/cts.html, NOT
# external/wpt/webgpu/cts.html, as the latter is not run.
# ****************************************************************************

#
# Test bugs
#

# These tests aren't working on CQ, unclear whether the test or harness is broken.
# Mac: mostly works
# Linux: actual is white/blank
crbug.com/1083478 [ Linux ] wpt_internal/webgpu/webgpu/web-platform/reftests/canvas_clear.html [ Failure ]
crbug.com/1083478 [ Linux ] wpt_internal/webgpu/webgpu/web-platform/reftests/canvas_complex_bgra8unorm.html [ Failure ]
# Win: actual is black
crbug.com/1083478 [ Win ] wpt_internal/webgpu/webgpu/web-platform/reftests/canvas_clear.html [ Failure ]
crbug.com/1083478 [ Win ] wpt_internal/webgpu/webgpu/web-platform/reftests/canvas_complex_bgra8unorm.html [ Failure ]

#
# Platform-independent failures
#

# Many bugs are contained here.
# - One of them is crbug.com/dawn/424
# - Mac: Timeout on worker seen at least once.
# - Win: Crash seen for r8snorm, rg11b10float, rg8snorm, rgba8snorm.
# - General: Test takes too long to run, needs to be split up.
#   (Not really worth implementing until there are fewer actual failures.)
# - Possibly also slower or hanging with validation layers.
wpt_internal/webgpu/cts.html?q=webgpu:api,operation,resource_init,copied_texture_clear:* [ Skip ]
wpt_internal/webgpu/cts.html?q=webgpu:api,operation,resource_init,sampled_texture_clear:* [ Skip ]
wpt_internal/webgpu/cts.html?q=webgpu:api,operation,resource_init,depth_stencil_attachment_clear:* [ Skip ]

crbug.com/dawn/375 wpt_internal/webgpu/cts.html?q=webgpu:api,validation,createBindGroup:buffer_offset_and_size_for_bind_groups_match:offset=0;size=0 [ Failure ]
crbug.com/dawn/375 wpt_internal/webgpu/cts.html?q=webgpu:api,validation,createBindGroup:buffer_offset_and_size_for_bind_groups_match:offset=256;size=0 [ Failure ]
crbug.com/dawn/375 wpt_internal/webgpu/cts.html?q=webgpu:api,validation,createBindGroup:buffer_offset_and_size_for_bind_groups_match:offset=1024;size=0 [ Failure ]
crbug.com/dawn/375 wpt_internal/webgpu/cts.html?q=webgpu:api,validation,createBindGroup:buffer_offset_and_size_for_bind_groups_match:offset=1024;size=undefined [ Failure ]

# Timeout on Windows/NVIDIA with backend validation
wpt_internal/webgpu/cts.html?q=webgpu:api,validation,createBindGroupLayout:max_resources_per_stage,in_pipeline_layout:* [ Failure Timeout ]

wpt_internal/webgpu/cts.html?q=webgpu:api,validation,createPipelineLayout:visibility_and_dynamic_offsets:type="writeonly-storage-texture";hasDynamicOffset=false;* [ Failure ]
wpt_internal/webgpu/cts.html?q=webgpu:api,validation,createPipelineLayout:visibility_and_dynamic_offsets:type="readonly-storage-texture";hasDynamicOffset=false;* [ Failure ]

crbug.com/dawn/383 wpt_internal/webgpu/cts.html?q=webgpu:api,validation,fences:signal_a_fence_on_a_different_device_than_it_was_created_on_is_invalid: [ Failure ]
crbug.com/dawn/383 wpt_internal/webgpu/cts.html?q=webgpu:api,validation,fences:signal_a_fence_on_a_different_device_does_not_update_fence_signaled_value: [ Failure ]

crbug.com/1069953 wpt_internal/webgpu/cts.html?q=webgpu:web-platform,copyImageBitmapToTexture:from_ImageData:* [ Failure ]

wpt_internal/webgpu/cts.html?q=webgpu:api,validation,vertex_state:check_two_attributes_overlapping: [ Failure ]

wpt_internal/webgpu/cts.html?q=webgpu:shader,execution,robust_access:* [ Skip ]

#
# Mac (Metal) specific
#

# Rendering differs slightly from ref.
crbug.com/1083478 [ Mac ] wpt_internal/webgpu/webgpu/web-platform/reftests/canvas_complex_bgra8unorm.html [ Failure ]

#
# Linux (Vulkan) specific
#

crbug.com/1014740 [ Linux ] wpt_internal/webgpu/cts.html?q=webgpu:api,operation,buffers,map_oom:mapReadAsync: [ Failure Crash ]
crbug.com/1014740 [ Linux ] wpt_internal/webgpu/cts.html?q=webgpu:api,operation,buffers,map_oom:mapWriteAsync: [ Failure Crash ]

crbug.com/dawn/399 [ Linux ] wpt_internal/webgpu/cts.html?q=webgpu:api,validation,createBindGroup:texture_binding_must_have_correct_usage:type="sampled-texture";* [ Crash ]
crbug.com/dawn/399 [ Linux ] wpt_internal/webgpu/cts.html?q=webgpu:api,validation,render_pass_descriptor:* [ Crash ]

[ Linux ] wpt_internal/webgpu/cts.html?q=webgpu:api,validation,createBindGroup:texture_binding_must_have_correct_usage:type="readonly-storage-texture";* [ Crash ]
[ Linux ] wpt_internal/webgpu/cts.html?q=webgpu:api,validation,createBindGroup:texture_binding_must_have_correct_usage:type="writeonly-storage-texture";* [ Crash ]

#
# Windows (D3D12) specific
#

crbug.com/dawn/323 [ Win ] wpt_internal/webgpu/cts.html?q=webgpu:api,validation,createPipelineLayout:visibility_and_dynamic_offsets:type="readonly-storage-buffer";hasDynamicOffset=true;visibility=0 [ Crash ]
crbug.com/dawn/323 [ Win ] wpt_internal/webgpu/cts.html?q=webgpu:api,validation,createPipelineLayout:visibility_and_dynamic_offsets:type="storage-buffer";hasDynamicOffset=true;visibility=0 [ Crash ]
crbug.com/dawn/323 [ Win ] wpt_internal/webgpu/cts.html?q=webgpu:api,validation,createPipelineLayout:visibility_and_dynamic_offsets:type="uniform-buffer";hasDynamicOffset=true;visibility=0 [ Crash ]
crbug.com/dawn/323 [ Win ] wpt_internal/webgpu/cts.html?q=webgpu:api,validation,createPipelineLayout:number_of_dynamic_buffers_exceeds_the_maximum_value:* [ Crash ]

crbug.com/1087130 [ Win ] wpt_internal/webgpu/cts.html?q=webgpu:api,validation,createView:* [ RetryOnFailure ]

# These fail on NVIDIA (but it's probably our bug)
crbug.com/1014738 [ Win ] wpt_internal/webgpu/cts.html?q=webgpu:api,operation,buffers,map_oom:mapReadAsync: [ Failure ]
crbug.com/1014738 [ Win ] wpt_internal/webgpu/cts.html?q=webgpu:api,operation,buffers,map_oom:mapWriteAsync: [ Failure ]

# Intel
crbug.com/1087131 [ Win ] wpt_internal/webgpu/cts.html?q=webgpu:api,operation,command_buffer,compute,basic:* [ Failure ]
