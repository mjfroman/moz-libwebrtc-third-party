<html>
<head>
    <script src="../resources/run-after-layout-and-paint.js"></script>
    <script src=media-controls.js></script>
</head>
<body>
<p>Making sure the controller looks ok after a second load().</p>
<video controls></video>
</body>
<script>
  if (window.testRunner)
    testRunner.waitUntilDone();

  const video = document.getElementsByTagName('video')[0];
  enableTestMode(video);

  video.addEventListener("canplaythrough", () => {
    video.src = "content/test.ogv";

    // Use a non-zero current time so that the seek isn't elided below.
    video.currentTime = 1;

    video.play().then(() => {
      video.pause();

      function endTest() {
        runAfterLayoutAndPaint(() => {
          if (window.testRunner)
            testRunner.notifyDone();
        });
      }

      let haveFrame = false;
      let haveSeek = false;
      video.requestVideoFrameCallback(() => {
        haveFrame = true;
        if (haveFrame && haveSeek) {
          endTest();
        }
      });

      // Ensure that the frame is always the same in pixel result.
      video.addEventListener("seeked", () => {
        haveSeek = true;
        if (haveFrame && haveSeek) {
          endTest();
        }
      }, { once: true });

      video.currentTime = 0;
    });
  }, { once: true });

  video.src = "content/counting.ogv";
</script>
</html>
